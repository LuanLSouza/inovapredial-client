<ion-content>

  <ion-header class="main-header">
    <ion-toolbar>
      <ion-title class="title">
        Funcionários
      </ion-title>
      <ion-buttons slot="end">
        <ion-button class="button" (click)="navigateToNewEmployee()">
          Novo Funcionário
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <ion-card class="filter-card">
    <ion-grid class="filter-grid">
      <ion-row class="filter-row" class="ion-align-items-end">
        <ion-col size="12" size-lg="4">
          <ion-label class="label">Nome</ion-label>
          <div class="input-wrapper">
            <ion-input 
              type="text" 
              placeholder="Nome" 
              fill="solid" 
              class="input solid"
              [(ngModel)]="searchName"
              (ionChange)="applyFilters()"
            ></ion-input>
            <ion-img src="../../../assets/images/advanced-filters-icon.png" class="advanced-filters-icon"></ion-img>
          </div>
        </ion-col>

        <ion-col size="12" size-lg="3">
          <ion-label class="label">Especialidade</ion-label>
          <ion-input 
            type="text" 
            placeholder="Especialidade" 
            fill="solid" 
            class="input solid"
            [(ngModel)]="searchSpecialty"
            (ionChange)="applyFilters()"
          ></ion-input>
        </ion-col>

        <ion-col size="12" size-lg="3">
          <ion-label class="label">Contato</ion-label>
          <ion-input 
            type="text" 
            placeholder="Contato" 
            fill="solid" 
            class="input solid"
            [(ngModel)]="searchContact"
            (ionChange)="applyFilters()"
          ></ion-input>
        </ion-col>

        <ion-col size="12" size-lg="2" class="btn-col">
          <ion-button class="clear" expand="block" (click)="clearFilters()">Limpar Filtros</ion-button>
        </ion-col>
        
      </ion-row>
    </ion-grid>
  </ion-card>
  
  <ion-card class="list-card">
    <div class="table-container">
      <ion-grid class="table-grid">
        <ion-row class="table-header">
        <ion-col class="col-name">
          <ion-label
          (click)="sortBy('name')"
          [class.sorted]="isSortedBy('name')"
          class="sortable-header"
          >
            Nome
            <ion-icon src="../../../assets/icons/ordenation-icon.svg"></ion-icon>
          </ion-label>
        </ion-col>
        <ion-col class="col-specialty">
          <ion-label
          (click)="sortBy('specialty')"
          [class.sorted]="isSortedBy('specialty')"
          class="sortable-header"
          >
            Especialidade
            <ion-icon src="../../../assets/icons/ordenation-icon.svg"></ion-icon>
          </ion-label>
        </ion-col>
        <ion-col class="col-contact">
          <ion-label
          (click)="sortBy('contact')"
          [class.sorted]="isSortedBy('contact')"
          class="sortable-header"
          >
            Contato
            <ion-icon src="../../../assets/icons/ordenation-icon.svg"></ion-icon>
          </ion-label>
        </ion-col>
        <ion-col class="col-actions"><ion-label>Ações</ion-label></ion-col>
      </ion-row>
      @if (loading) {
        <ion-row>
          <ion-col size="12" class="ion-text-center">
            <ion-spinner name="crescent"></ion-spinner>
          </ion-col>
        </ion-row>
      } @else if (employees.length === 0) {
        <ion-row>
          <ion-col size="12">
            <ion-item lines="none">
              <ion-label>Nenhum funcionário encontrado</ion-label>
            </ion-item>
          </ion-col>
        </ion-row>
      } @else {
        @for (employee of employees; track employee.id) {
          <ion-row class="table-row" button="true">
            <ion-col class="col-name">
              <div class="name-cell">
                <div class="name"> {{ employee.name }} </div>
              </div>
            </ion-col>
            <ion-col class="col-specialty">
              <ion-label>{{ employee.specialty || '-' }}</ion-label>
            </ion-col>
            <ion-col class="col-contact">
              <ion-label>{{ employee.contact || '-' }}</ion-label>
            </ion-col>

            <ion-col class="col-actions actions">
              <ion-buttons>
                <ion-button fill="clear"
                (click)="onDelete(employee)"
                >
                  <ion-icon src="../../../assets/icons/trash-icon.svg"></ion-icon>
                </ion-button>
                <ion-button fill="clear"
                (click)="onEdit(employee)"
                >
                  <ion-icon src="../../../assets/icons/pencil-icon.svg"></ion-icon>
                </ion-button>
                <ion-button fill="clear" (click)="onView(employee)">
                  <ion-icon src="../../../assets/icons/eye-icon.svg"></ion-icon>
                </ion-button>
              </ion-buttons>
            </ion-col>
          </ion-row>
        }
      }

      </ion-grid>
    </div>
    <ion-item lines="full" detail="false" class="grid-divider"></ion-item>
    <ion-grid>
      <ion-row class="pagination-bar ion-aling-items-center ion-justify-content-between">
        <ion-col size="12" size-lg="4" class="pagination-info">
          <div class="pagination-content">
            <ion-note>{{showingStart}}-{{showingEnd}} de {{totalElements}} </ion-note>
            <ion-label class="page-size-label">Itens por páginas:</ion-label>
            <ion-select
              interface="popover"
              class="page-size-select"
              [value]="pageSize"
              (ionChange)="onPageSizeChange($event.detail.value)"
            >
              @for (size of pageSizeOptions; track size) {
                <ion-select-option [value]="size">{{size}}</ion-select-option>
              }
            </ion-select>
        </div>
        </ion-col>

        <ion-col size="12" size-lg="4" class="pagination-controls ion-text-end">

          <ion-buttons class="pagination-buttons">
            <ion-button fill="clear" size="small" (click)="goToFirtPage()" [disabled]="currentPage === 0 || loading">
              <ion-icon src="../../../assets/icons/goToFirst-icon.svg"></ion-icon>
            </ion-button>
            <ion-button fill="clear" (click)="goToPreviousPage()" [disabled]="!hasPrevious || loading">
              <ion-icon src="../../../assets/icons/previous-icon.svg"></ion-icon>
            </ion-button>

            @if (pageNumbers.length > 0) {
              @for (p of pageNumbers; track p) {
                <ion-button
                  fill="solid"
                  class="page-number"
                  [color]="p === currentPage ? 'primary' : 'medium'"
                  (click)="goToPage(p)"
                  [disabled]="loading"
                >
                  {{p + 1}}
                </ion-button>
              }
            }

            <ion-button fill="clear" (click)="goToNextPage()" [disabled]="!hasNext || loading">
              <ion-icon src="../../../assets/icons/next-icon.svg"></ion-icon>
            </ion-button>
            <ion-button fill="clear" (click)="goToLastPage()" [disabled]="currentPage === totalPages - 1 || loading">
              <ion-icon src="../../../assets/icons/goToLast-icon.svg"></ion-icon>
            </ion-button>
          </ion-buttons>

        </ion-col>
      </ion-row>

    </ion-grid>
  </ion-card>

</ion-content>
